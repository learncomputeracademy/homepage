<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="robots" content="noindex,nofollow" />
    <title>Learn Computer Academy Home Page</title>
    <link rel="icon" type="image/x-icon" href="https://www.google.com/s2/favicons?sz=64&domain_url=learncomputer.in">
    <link href="css/style.css" type="text/css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --border-color: #dddddd;
            --primary-color: #ff7810;
            --hover-bg: #f0f0f0;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        body[data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --border-color: #444444;
            --hover-bg: #333333;
            --shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        /* General Modal Styles */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 5% auto;
            padding: 25px;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            position: relative;
            font-family: sans-serif;
        }
        
        .modal-content h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .close-button {
            color: var(--text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 32px;
            font-weight: bold;
            z-index: 10;
        }

        .close-button:hover,
        .close-button:focus {
            color: #ff7810;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Styles for bottom nav icons */
        .bottom-nav i {
            font-size: 36px;
            color: var(--text-color);
            transition: 0.3s ease-in-out;
        }
        .bottom-nav a:hover i {
            color: var(--primary-color);
        }

        /* Styles for Code Tool Modal */
        #code-tool-modal .modal-content {
            max-width: 90%;
            width: 1400px;
        }
        .code-tool-container { display: flex; flex-direction: column; gap: 15px; }
        .code-tool-header { display: flex; justify-content: space-between; align-items: center; }
        .code-tool-header h3 { margin: 0; font-size: 24px; }
        .code-tool-controls { display: flex; align-items: center; gap: 15px; }
        .code-tool-options { display: none; gap: 20px; align-items: center; padding: 10px; background: var(--hover-bg); border-radius: 6px; }
        .code-tool-options label { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .code-tool-body { display: grid; grid-template-columns: 1fr 40px 1fr; gap: 10px; height: 65vh; }
        .code-pane { border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border-color); }
        .CodeMirror { flex-grow: 1; height: auto; font-family: 'Fira Code', monospace; font-size: 14px; }
        .code-tool-footer { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding-top: 15px; border-top: 1px solid var(--border-color); }
        .code-tool-footer button, .code-tool-controls button { padding: 10px 20px; border: 1px solid var(--border-color); border-radius: 5px; background-color: transparent; color: var(--text-color); cursor: pointer; font-size: 16px; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .code-tool-footer button:hover, .code-tool-controls button:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .code-tool-controls select { padding: 10px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); }
        .stats-bar { font-size: 12px; color: #aaa; padding: 5px 10px; text-align: right; background-color: #272822; border-top: 1px solid #444; }
        .swap-pane { display: flex; align-items: center; justify-content: center; }
        #swap-btn { background: var(--hover-bg); border: 1px solid var(--border-color); color: var(--text-color); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: all 0.3s; font-size: 20px; display: flex; align-items: center; justify-content: center; }
        #swap-btn:hover { transform: rotate(180deg); background-color: var(--primary-color); color: white; }

        /* Styles for Settings Modal */
        #settings-modal .modal-content { max-width: 700px; }
        .settings-container { display: flex; flex-direction: column; gap: 20px; }
        .settings-tabs { display: flex; border-bottom: 1px solid var(--border-color); }
        .settings-tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -1px; color: var(--text-color); }
        .settings-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .settings-pane { display: none; padding: 15px 5px; animation: fadeIn 0.5s; }
        .settings-pane.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* General Form Group Styles */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input[type="text"],
        .form-group input[type="url"],
        .form-group input[type="color"],
        .form-group input[type="file"] {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
        }
        .form-group input[type="color"] { width:50px; padding:0 }
        .form-group .color-inputs { display: flex; gap: 10px; align-items: center; }
        .form-group .image-note { font-size: 12px; opacity: 0.7; margin-top: 5px; }

        /* Bookmark Editor List Styles */
        #bookmark-editor-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        #bookmark-editor-list li { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 8px; cursor: grab; background-color: var(--bg-color); }
        #bookmark-editor-list li.dragging { opacity: 0.5; background: var(--hover-bg); }
        #bookmark-editor-list img { width: 24px; height: 24px; object-fit: contain; }
        #bookmark-editor-list .bookmark-info { flex-grow: 1; }
        #bookmark-editor-list .bookmark-actions button { background: none; border: none; color: var(--text-color); cursor: pointer; font-size: 18px; padding: 2px 5px; }
        #bookmark-editor-list .bookmark-actions button:hover { color: var(--primary-color); }

        /* General Button Styles */
        .settings-btn, .settings-pane button, label.settings-btn, .form-button {
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: transparent;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }
        .settings-btn:hover, .settings-pane button:hover, label.settings-btn:hover, .form-button:hover {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .data-buttons {
            display: flex;
            gap: 10px;
        }

        /* Styles for new Bookmark Form Modal */
        #bookmark-form-modal .modal-content { max-width: 500px; }
        #bookmark-image-preview {
            max-width: 98px;
            max-height: 34px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-top: 10px;
            object-fit: contain;
        }
        
    </style>
</head>
<body data-theme="light">
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="weather-info"><span class="weather-icon"></span><span class="weather-temp"></span></div>
        <div class="time-info"><span class="time-display"></span>
            <svg class="time-icon" width="24" height="24" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="none" stroke="var(--text-color)" stroke-width="2"/>
                <line id="hourHand" x1="12" y1="12" x2="12" y2="6" stroke="var(--text-color)" stroke-width="2" stroke-linecap="round"/>
                <line id="minuteHand" x1="12" y1="12" x2="12" y2="4" stroke="var(--text-color)" stroke-width="1.5" stroke-linecap="round"/>
                <line id="secondHand" x1="12" y1="12" x2="12" y2="3" stroke="var(--primary-color)" stroke-width="1" stroke-linecap="round"/>
            </svg>
        </div>
    </div>

    <!-- Canvas for background grid -->
    <canvas id="gridCanvas"></canvas>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="logo-block">
                <a href="https://learncomputer.in/" target="_blank" rel="nofollow">
                  <img src="images/logo.png" data-dark-src="images/logo-light.png" alt="Logo" class="theme-logo">
                </a>
            </div>
            <div class="nav-links" id="search-tabs">
                <ul>
                    <li><a href="#" class="active" data-type="web">Web</a></li>
                    <li><a href="#" data-type="images">Images</a></li>
                    <li><a href="#" data-type="videos">Videos</a></li>
                    <li><a href="#" data-type="news">News</a></li>
                    <li><a href="#" onclick="window.open('https://playground.learncomputer.in/search/', '_blank');">Advanced</a></li>
                </ul>
            </div>
            <div class="search-bar">
                <div class="custom-dropdown">
                    <div class="selected-option"><img src="images/google.png" alt="Selected" class="dropdown-img"><i class="arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M16.53 8.97a.75.75 0 0 1 0 1.06l-4 4a.75.75 0 0 1-1.06 0l-4-4a.75.75 0 1 1 1.06-1.06L12 12.44l3.47-3.47a.75.75 0 0 1 1.06 0" clip-rule="evenodd"/></svg></i></div>
                    <ul class="dropdown-options">
                        <li data-value="google"><img src="images/google.png" alt="Google"></li>
                        <li data-value="freepik"><img src="images/freepik.png" alt="Freepik"></li>
                        <li data-value="flaticon"><img src="images/flaticon.png" alt="Flaticon"></li>
                        <li data-value="pinterest"><img src="images/pinterest.png" alt="Pinterest"></li>
                        <li data-value="pexels"><img src="images/pexels.png" alt="pexels"></li>
                        <li data-value="codepen"><img src="images/codepen.png" alt="CodePen"></li>
                        <li data-value="themeforest"><img src="images/themeforest.png" alt="ThemeForest"></li>
                        <li data-value="youtube"><img src="images/youtube.png" alt="YouTube"></li>
                        <li data-value="amazon"><img src="images/amazon.png" alt="Amazon"></li>
                        <li data-value="bing"><img src="images/bing-e1535596079626-100x46.png" alt="Bing"></li>
                        <li data-value="yahoo"><img src="images/yahoo.png" alt="Yahoo"></li>
                        <li data-value="wikipedia"><img src="images/wikipedia-100x50.png" alt="Wikipedia"></li>
                        <li data-value="duckduckgo"><img src="images/duckduckgo.png" alt="DuckDuckGo"></li>
                        <li data-value="askcom"><img src="images/askcom-e1535595197682-100x41.png" alt="Ask.com"></li>
                        <li data-value="aol"><img src="images/aol1-e1535595499271-100x38.png" alt="AOL"></li>
                        <li data-value="facebook"><img src="images/facebook.png" alt="Facebook"></li>
                        <li data-value="reddit"><img src="images/reddit.png" alt="Reddit"></li>
                        <li data-value="twitter"><img src="images/twitter.png" alt="Twitter"></li>
                        <li data-value="ebay"><img src="images/ebay-100x50.png" alt="eBay"></li>
                        <li data-value="instagram"><img src="images/instagram-100x50.png" alt="Instagram"></li>
                        <li data-value="imdb"><img src="images/imdb.png" alt="IMDb"></li>
                        <li data-value="espn"><img src="images/espn.png" alt="ESPN"></li>
                        <li data-value="godaddy"><img src="images/godaddy.png" alt="GoDaddy"></li>
                        <li data-value="dictionary"><img src="images/dictionary-com.png" alt="Dictionary"></li>
                    </ul>
                </div>
                <input type="hidden" id="selectedValue" value="google">
                <input type="text" placeholder="Search the web...">
                <button><i class='bx bx-search'></i></button>
            </div>
            <ul class="box-container">
                <!-- Bookmarks will be populated here by JavaScript -->
            </ul>
        </div>
    </main>

    <!-- Bottom Nav -->
    <section class="bottom-nav">
        <div class="container">
            <ul>
                <li><a href="https://review.computercenter.in/" target="_blank" rel="nofollow" title="Review Learn Computer Academy"><img src="images/google-reviews.png" alt="Google Reviews"></a></li>
                <li><a href="#" id="code-tool-btn" title="Code Minifier & Beautifier"><i class='bx bx-code-alt'></i></a></li>
                <li><a href="#" id="install-help-btn" title="How to Install Extension"><i class='bx bx-help-circle'></i></a></li>
                <li><a href="./files/NetworkReset-RunAsAdminstrator.bat" target="_blank" rel="nofollow" title="Network Reset Code for Windows PC"><img src="images/network-reset.png" alt="Network Reset"></a></li>
                <li><a href="#" id="settings-btn" title="Settings"><i class='bx bx-cog'></i></a></li>
            </ul>
        </div>
    </section>

    <!-- Theme Toggle Button -->
    <button id="themeToggle" class="theme-toggle"><span class="bulb"></span></button>

    <!-- MODALS SECTION -->
    <div id="install-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>How to Install the Chrome Extension</h3>
            <ol>
                <li><strong>Download:</strong> &nbsp; &nbsp;Download the Plugin by clicking on this link - <a href="https://homepage.computercenter.in/lca-homepage-extension.zip" style="color:#ff7810" download="lca-homepage-extension.zip" target="_blank" rel="noopener noreferrer">https://homepage.computercenter.in/lca-homepage-extension.zip</a>.</li>
                <li><strong>Unzip the File:</strong> Once you download the <code>lca-homepage-extension.zip</code> file, you must unzip it.</li>
                <li><strong>Open Chrome Extensions:</strong> Open Google Chrome, type <code>chrome://extensions</code> into the address bar, and press Enter.</li>
                <li><strong>Enable Developer Mode:</strong> In the top-right corner, turn <strong>on</strong> "Developer mode".</li>
                <li><strong>Load the Extension:</strong> Click "Load unpacked" and select the unzipped folder.</li>
            </ol>
        </div>
    </div>
    
    <div id="code-tool-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="code-tool-container">
                <div class="code-tool-header">
                    <h3><i class='bx bx-code-curly' style="vertical-align: middle;"></i> Code Minifier & Beautifier</h3>
                     <div class="code-tool-controls">
                        <button id="upload-btn"><i class='bx bx-upload'></i> Upload File</button>
                        <input type="file" id="file-input" style="display: none;">
                        <select id="code-language-select">
                            <option value="htmlmixed">HTML</option>
                            <option value="css">CSS</option>
                            <option value="javascript">JavaScript</option>
                            <option value="php">PHP</option>
                        </select>
                    </div>
                </div>
                <div class="code-tool-options">
                    <label><input type="checkbox" id="option-sort-css"> Sort CSS Properties</label>
                </div>
                <div class="code-tool-body">
                    <div class="code-pane">
                        <textarea id="code-input-textarea" spellcheck="false"></textarea>
                        <div id="input-stats" class="stats-bar">Chars: 0 | Lines: 0</div>
                    </div>
                    <div class="swap-pane">
                        <button id="swap-btn" title="Swap Panes"><i class='bx bx-transfer-alt'></i></button>
                    </div>
                    <div class="code-pane">
                       <textarea id="code-output-textarea" readonly spellcheck="false"></textarea>
                       <div id="output-stats" class="stats-bar">Chars: 0 | Lines: 0</div>
                    </div>
                </div>
                <div class="code-tool-footer">
                    <button id="beautify-btn"><i class='bx bxs-magic-wand'></i> Beautify</button>
                    <button id="minify-btn"><i class='bx bx-unite'></i> Minify</button>
                    <button id="remove-comments-btn"><i class='bx bx-comment-x'></i> Remove Comments</button>
                    <button id="copy-btn"><i class='bx bx-copy'></i> Copy Result</button>
                    <button id="clear-btn"><i class='bx bx-trash'></i> Clear</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="settings-container">
                <h3>Settings</h3>
                <div class="settings-tabs">
                    <div class="settings-tab active" data-pane="bookmarks">Bookmarks</div>
                    <div class="settings-tab" data-pane="appearance">Appearance</div>
                    <div class="settings-tab" data-pane="data">Data</div>
                </div>
                <div class="settings-content">
                    <div id="pane-appearance" class="settings-pane">
                        <h4>Background Style</h4>
                        <div class="form-group"><label><input type="radio" name="bg-type" value="default" checked> Default Grid</label><label><input type="radio" name="bg-type" value="gradient"> Gradient</label><label><input type="radio" name="bg-type" value="image"> Image</label></div>
                        <div id="gradient-settings" class="form-group" style="display: none;"><label>Gradient Colors</label><div class="color-inputs"><input type="color" id="gradient-color-1" value="#8EC5FC"><input type="color" id="gradient-color-2" value="#E0C3FC"></div></div>
                        <div id="image-settings" class="form-group" style="display: none;"><label for="bg-image-url">Background Image URL</label><input type="url" id="bg-image-url" placeholder="https://example.com/image.jpg"></div>
                        <button id="apply-background-btn" class="settings-btn">Apply Background</button>
                        <button id="reset-background-btn" class="settings-btn">Reset Design</button>
                    </div>
                    <div id="pane-bookmarks" class="settings-pane  active">
                        <h4>Manage Bookmarks</h4>
                        <p>Drag and drop to reorder.</p>
                        <ul id="bookmark-editor-list"></ul>
                        <button id="add-bookmark-btn" class="settings-btn" style="margin-top: 15px;">Add New Bookmark</button>
                    </div>
                    <div id="pane-data" class="settings-pane">
                        <h4>Import & Export</h4>
                         <div class="form-group data-buttons">
                            <button id="export-settings-btn" class="settings-btn">Export Settings</button>
                            <label for="import-settings-input" class="settings-btn">Import Settings</label>
                            <input type="file" id="import-settings-input" accept=".json" style="display: none;">
                        </div>
                        <p style="font-size: 12px; opacity: 0.8;">Save or load your settings to/from a JSON file.</p>
                        
                        <h4>Reset</h4>
                        <div class="form-group">
                            <button id="reset-all-btn" class="settings-btn">Reset All Settings</button>
                            <p style="font-size: 12px; opacity: 0.8;">This will restore all bookmarks and settings to their original defaults. This action cannot be undone.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOOKMARK FORM MODAL (UPDATED) -->
    <div id="bookmark-form-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="bookmark-form-title">Add Bookmark</h3>
            <form id="bookmark-form">
                <input type="hidden" id="bookmark-edit-index">
                <input type="hidden" id="bookmark-image-hidden-src">
                <div class="form-group">
                    <label for="bookmark-name">Name</label>
                    <input type="text" id="bookmark-name" required>
                </div>
                <div class="form-group">
                    <label for="bookmark-url">URL</label>
                    <input type="url" id="bookmark-url" required>
                </div>
                <div class="form-group">
                    <label for="bookmark-image-upload">Image</label>
                    <input type="file" id="bookmark-image-upload" accept="image/*">
                    <p class="image-note">Recommended image size is 98x34 px.</p>
                    <img id="bookmark-image-preview" src="" alt="Image Preview" style="display: none;">
                </div>
                <button type="submit" id="save-bookmark-btn" class="form-button">Save Bookmark</button>
            </form>
        </div>
    </div>

    <!-- JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/php/php.min.js"></script>


    <script>
    document.addEventListener("DOMContentLoaded", function () {
        // --- GLOBAL SELECTORS ---
        const body = document.body;
        const canvas = document.getElementById('gridCanvas');
        const ctx = canvas.getContext('2d');
        const themeLogo = document.querySelector('.theme-logo');
        const boxContainer = document.querySelector('.box-container');
        const searchInput = document.querySelector(".search-bar input[type='text']");

        // --- THEME & GRID ---
        function drawGrid() {
            if (!canvas) return;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const gridSize = 50;
            ctx.strokeStyle = body.dataset.theme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }
        }

        function setTheme(theme) {
            body.dataset.theme = theme;
            themeLogo.src = theme === 'dark' ? themeLogo.dataset.darkSrc : 'images/logo.png';
            localStorage.setItem('themePreference', theme);
            drawGrid();
        }

        // --- SETTINGS & DATA MANAGEMENT ---
        let userSettings = {};
        const defaultSettings = {
            background: { type: 'default', value: '' },
            bookmarks: []
        };

        function saveSettings() {
            localStorage.setItem('lcaHomepageSettings', JSON.stringify(userSettings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('lcaHomepageSettings');
            if (saved) {
                try {
                    userSettings = JSON.parse(saved);
                } catch (e) {
                    console.error("Error parsing settings from localStorage", e);
                    userSettings = JSON.parse(JSON.stringify(defaultSettings));
                }
                applySettings();
            } else {
                fetch('homepage.json')
                    .then(response => {
                        if (!response.ok) throw new Error('Default bookmarks not found');
                        return response.json();
                    })
                    .then(data => {
                        userSettings = JSON.parse(JSON.stringify(defaultSettings));
                        userSettings.bookmarks = data;
                        applySettings();
                        saveSettings();
                    })
                    .catch(error => {
                        console.error('Error fetching default bookmarks:', error);
                        userSettings = JSON.parse(JSON.stringify(defaultSettings));
                        applySettings();
                    });
            }
        }

        function applySettings() {
            applyBackground();
            renderBookmarks();
        }

        function renderBookmarks() {
            boxContainer.innerHTML = '';
            if (!userSettings.bookmarks) return;
            userSettings.bookmarks.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<a class="box" href="${item.href}" target="_blank" rel="nofollow"><img src="${item.imgSrc}" alt="${item.alt}"></a>`;
                boxContainer.appendChild(li);
            });
        }
        
        function applyBackground() {
            const bg = userSettings.background;
            body.style.backgroundImage = '';
            body.style.background = '';
            canvas.style.display = 'none';

            switch (bg ? bg.type : 'default') {
                case 'gradient':
                    body.style.background = bg.value;
                    break;
                case 'image':
                    body.style.backgroundImage = `url('${bg.value}')`;
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    break;
                default:
                    canvas.style.display = 'block';
                    drawGrid();
                    break;
            }
        }

        // --- SEARCH LOGIC ---
        const dropdown = document.querySelector(".custom-dropdown");
        const selectedOption = dropdown.querySelector(".selected-option");
        const dropdownOptions = dropdown.querySelector(".dropdown-options");
        const hiddenInput = document.getElementById("selectedValue");
        const searchButton = document.querySelector(".search-bar button");
        const navLinks = document.querySelectorAll(".nav-links a");
        const searchTabs = document.getElementById("search-tabs");

        const searchEngines = {
            google: { web: "https://www.google.com/search?q=", images: "https://www.google.com/search?tbm=isch&q=", videos: "https://www.google.com/search?tbm=vid&q=", news: "https://news.google.com/search?q=" },
            bing: { web: "https://www.bing.com/search?q=", images: "https://www.bing.com/images/search?q=", videos: "https://www.bing.com/videos/search?q=", news: "https://www.bing.com/news/search?q=" },
            yahoo: { web: "https://search.yahoo.com/search?p=", images: "https://images.search.yahoo.com/search/images?p=", videos: "https://video.search.yahoo.com/search/video?p=", news: "https://news.search.yahoo.com/search?p=" },
            duckduckgo: { web: "https://duckduckgo.com/?q=" },
            pinterest: "https://www.pinterest.com/search/pins/?q=", pexels: "https://www.pexels.com/search/", codepen: "https://codepen.io/search/pens?q=", themeforest: "https://themeforest.net/search/",
            freepik: "https://www.freepik.com/search?query=", flaticon: "https://www.flaticon.com/search?word=", youtube: "https://www.youtube.com/results?search_query=", amazon: "https://www.amazon.in/s?k=",
            wikipedia: "https://en.wikipedia.org/wiki/", askcom: "https://www.ask.com/web?q=", aol: "https://search.aol.com/aol/search?q=", facebook: "https://www.facebook.com/search/top?q=",
            reddit: "https://www.reddit.com/search/?q=", twitter: "https://twitter.com/search?q=", ebay: "https://www.ebay.com/sch/i.html?_nkw=", instagram: "https://www.instagram.com/explore/tags/",
            imdb: "https://www.imdb.com/find?q=", espn: "https://www.espn.com/search/results?q=", godaddy: "https://www.godaddy.com/domains/searchresults.aspx?domainToCheck=", dictionary: "https://www.dictionary.com/browse/"
        };
        let currentSearchType = "web";

        function updateTabsVisibility(engine) {
            const supportsTabs = searchEngines[engine] && typeof searchEngines[engine] === "object";
            searchTabs.style.display = supportsTabs ? "block" : "none";
            if (!supportsTabs && navLinks[0]) navLinks[0].classList.add("active");
        }

        function performSearch() {
            const query = encodeURIComponent(searchInput.value.trim());
            const engine = hiddenInput.value;
            if (!query) { searchInput.focus(); return; }
            let url = searchEngines[engine];
            if (typeof url === "object" && url[currentSearchType]) url = url[currentSearchType];
            window.open(url + query, "_blank");
            searchInput.value = "";
        }

        // --- TOP BAR: WEATHER & TIME ---
        function updateWeather() {
            const weatherTemp = document.querySelector('.weather-temp');
            const weatherIcon = document.querySelector('.weather-icon');
            fetch('https://api.open-meteo.com/v1/forecast?latitude=22.8420&longitude=88.6560&current=temperature_2m,weather_code&timezone=Asia/Kolkata')
                .then(response => response.ok ? response.json() : Promise.reject(`HTTP error! status: ${response.status}`))
                .then(data => {
                    weatherTemp.textContent = `${Math.round(data.current.temperature_2m)}Â°C`;
                    const iconMap = { 0: '01d', 1: '02d', 2: '03d', 3: '04d', 61: '10d', 80: '09d' };
                    weatherIcon.style.backgroundImage = `url(https://openweathermap.org/img/wn/${iconMap[data.current.weather_code] || '01d'}.png)`;
                })
                .catch(error => { console.error('Error fetching weather:', error); weatherTemp.textContent = 'N/A'; });
        }

        function updateTime() {
            const timeDisplay = document.querySelector('.time-display');
            const hourHand = document.getElementById('hourHand');
            const minuteHand = document.getElementById('minuteHand');
            const secondHand = document.getElementById('secondHand');
            const now = new Date();
            timeDisplay.textContent = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
            const hours = now.getHours() % 12, minutes = now.getMinutes(), seconds = now.getSeconds();
            hourHand.setAttribute('transform', `rotate(${(hours * 30) + (minutes * 0.5)}, 12, 12)`);
            minuteHand.setAttribute('transform', `rotate(${minutes * 6}, 12, 12)`);
            secondHand.setAttribute('transform', `rotate(${seconds * 6}, 12, 12)`);
        }

        // --- MODAL HANDLING ---
        function setupModal(modalId, buttonId, openCallback) {
            const modal = document.getElementById(modalId);
            const btn = document.getElementById(buttonId);
            const closeBtn = modal.querySelector(".close-button");
            if (btn) {
                btn.onclick = (e) => { 
                    e.preventDefault(); 
                    if(openCallback) openCallback(); 
                    modal.style.display = "block"; 
                };
            }
            if(closeBtn) closeBtn.onclick = () => { modal.style.display = "none"; };
            return modal;
        }
        const installModal = setupModal("install-modal", "install-help-btn");
        const codeToolModal = setupModal("code-tool-modal", "code-tool-btn");
        const settingsModal = setupModal("settings-modal", "settings-btn", () => populateSettingsForm());
        const bookmarkFormModal = setupModal("bookmark-form-modal", null); // Opened programmatically
        window.addEventListener('click', (event) => {
            if (event.target == installModal) installModal.style.display = "none";
            if (event.target == codeToolModal) codeToolModal.style.display = "none";
            if (event.target == settingsModal) settingsModal.style.display = "none";
            if (event.target == bookmarkFormModal) bookmarkFormModal.style.display = "none";
        });

        // --- CODE TOOL LOGIC ---
        const commonConfig = { lineNumbers: true, theme: "monokai", lineWrapping: true, indentUnit: 4, tabSize: 4, };
        const inputEditor = CodeMirror.fromTextArea(document.getElementById('code-input-textarea'), { ...commonConfig, mode: 'htmlmixed' });
        const outputEditor = CodeMirror.fromTextArea(document.getElementById('code-output-textarea'), { ...commonConfig, mode: 'htmlmixed', readOnly: true });
        const langSelect = document.getElementById('code-language-select');
        const optionsContainer = document.querySelector('.code-tool-options');
        
        const inputStats = document.getElementById('input-stats');
        const outputStats = document.getElementById('output-stats');

        function updateEditorStats(editor, statsEl) {
            const value = editor.getValue();
            const charCount = value.length;
            const lineCount = editor.lineCount();
            statsEl.textContent = `Chars: ${charCount} | Lines: ${lineCount}`;
        }

        inputEditor.on('change', (cm) => {
            updateEditorStats(cm, inputStats);
        });
        
        outputEditor.on('change', (cm) => {
            updateEditorStats(cm, outputStats);
        });

        langSelect.addEventListener('change', () => {
            const lang = langSelect.value;
            // Handle PHP mode specifically as it's complex
            const mode = lang === 'php' ? { name: "php", startOpen: true } : lang;
            inputEditor.setOption('mode', mode);
            outputEditor.setOption('mode', mode);
            optionsContainer.style.display = lang === 'css' ? 'flex' : 'none';
        });

        // Basic PHP beautifier (indentation only)
        function beautify_php(code) {
            let indentLevel = 0;
            const indent_size = 4;
            const indent_char = ' '.repeat(indent_size);
            let beautifiedCode = '';
            const lines = code.split('\n');

            for (let line of lines) {
                line = line.trim();
                if (line.length === 0) continue;

                if (line.endsWith('}') || line.endsWith('};')) {
                    indentLevel = Math.max(0, indentLevel - 1);
                }
                
                beautifiedCode += indent_char.repeat(indentLevel) + line + '\n';
                
                if (line.endsWith('{')) {
                    indentLevel++;
                }
            }
            return beautifiedCode;
        }

        document.getElementById('beautify-btn').addEventListener('click', () => {
            const code = inputEditor.getValue();
            if (!code) return;
            const options = { indent_size: 4, space_in_empty_paren: true };
            let beautifiedCode = '';
            try {
                const lang = langSelect.value;
                if (lang === 'javascript') beautifiedCode = js_beautify(code, options);
                else if (lang === 'css') beautifiedCode = css_beautify(code, options);
                else if (lang === 'php') beautifiedCode = beautify_php(code);
                else beautifiedCode = html_beautify(code, options);
                outputEditor.setValue(beautifiedCode);
            } catch (e) { outputEditor.setValue("Error: " + e.message); }
        });
        
        // Function to remove comments based on language
        function removeComments(code, lang) {
            let result = code;
            // Regex for block comments: /* ... */
            const blockCommentRegex = /\/\*[\s\S]*?\*\//g;
            // Regex for single-line comments, avoiding URLs: //... or #...
            const singleLineCommentRegex = /(?<!:)\/\/[^\r\n]*|#[^\r\n]*/g;
             // Regex for HTML comments: <!-- ... -->
            const htmlCommentRegex = /<!--[\s\S]*?-->/g;

            switch(lang) {
                case 'css':
                    result = result.replace(blockCommentRegex, '').replace(singleLineCommentRegex, '');
                    break;
                case 'javascript':
                    result = result.replace(blockCommentRegex, '').replace(singleLineCommentRegex, '');
                    break;
                case 'htmlmixed':
                case 'php':
                    result = result.replace(htmlCommentRegex, '');
                    result = result.replace(blockCommentRegex, '');
                    result = result.replace(singleLineCommentRegex, '');
                    break;
            }
            return result;
        }

        document.getElementById('minify-btn').addEventListener('click', () => {
            let code = inputEditor.getValue();
            if (!code) return;
            // First remove comments, then minify whitespace
            let minifiedCode = removeComments(code, langSelect.value);
            minifiedCode = minifiedCode.replace(/\s+/g, ' ').trim();
            outputEditor.setValue(minifiedCode);
        });
        
        document.getElementById('remove-comments-btn').addEventListener('click', () => {
            const code = inputEditor.getValue();
            if (!code) return;
            outputEditor.setValue(removeComments(code, langSelect.value));
        });

        document.getElementById('copy-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(outputEditor.getValue());
        });
        document.getElementById('clear-btn').addEventListener('click', () => {
            inputEditor.setValue('');
            outputEditor.setValue('');
        });
        document.getElementById('swap-btn').addEventListener('click', () => {
            const temp = inputEditor.getValue();
            inputEditor.setValue(outputEditor.getValue());
            outputEditor.setValue(temp);
        });
        const fileInput = document.getElementById('file-input');
        document.getElementById('upload-btn').addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => inputEditor.setValue(e.target.result);
                reader.readAsText(file);
            }
        });
        const observer = new MutationObserver(() => {
            if (codeToolModal.style.display === 'block') {
                inputEditor.refresh();
                outputEditor.refresh();
            }
        });
        observer.observe(codeToolModal, { attributes: true, attributeFilter: ['style'] });


        // --- SETTINGS MODAL LOGIC ---
        settingsModal.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                settingsModal.querySelector('.settings-tab.active').classList.remove('active');
                settingsModal.querySelector('.settings-pane.active').classList.remove('active');
                tab.classList.add('active');
                settingsModal.querySelector(`#pane-${tab.dataset.pane}`).classList.add('active');
            });
        });
        
        function populateSettingsForm() {
            const bg = userSettings.background;
            document.querySelector(`input[name="bg-type"][value="${bg ? bg.type : 'default'}"]`).checked = true;
            if (bg && bg.type === 'gradient' && bg.value) {
                const colors = bg.value.match(/#[0-9a-fA-F]{6}/g);
                if (colors && colors.length >= 2) {
                    document.getElementById('gradient-color-1').value = colors[0];
                    document.getElementById('gradient-color-2').value = colors[1];
                }
            } else if (bg && bg.type === 'image') {
                document.getElementById('bg-image-url').value = bg.value;
            }
            toggleBackgroundControls();
            renderBookmarkEditor();
        }

        const bgTypeRadios = document.querySelectorAll('input[name="bg-type"]');
        function toggleBackgroundControls() {
            const type = document.querySelector('input[name="bg-type"]:checked').value;
            document.getElementById('gradient-settings').style.display = type === 'gradient' ? 'block' : 'none';
            document.getElementById('image-settings').style.display = type === 'image' ? 'block' : 'none';
        }
        bgTypeRadios.forEach(radio => radio.addEventListener('change', toggleBackgroundControls));

        document.getElementById('apply-background-btn').addEventListener('click', () => {
            const type = document.querySelector('input[name="bg-type"]:checked').value;
            let value = '';
            if (type === 'gradient') {
                value = `linear-gradient(90deg, ${document.getElementById('gradient-color-1').value}, ${document.getElementById('gradient-color-2').value})`;
            } else if (type === 'image') {
                value = document.getElementById('bg-image-url').value;
            }
            userSettings.background = { type, value };
            saveSettings();
            applyBackground();
        });

        document.getElementById('reset-background-btn').addEventListener('click', () => {
            userSettings.background = { type: 'default', value: '' };
            saveSettings();
            applyBackground();
            populateSettingsForm();
        });

        document.getElementById('reset-all-btn').addEventListener('click', () => {
            if (confirm("Are you sure you want to reset all settings and bookmarks to their default state? This cannot be undone.")) {
                localStorage.removeItem('lcaHomepageSettings');
                loadSettings();
                populateSettingsForm();
            }
        });


        // --- IMPROVED BOOKMARK MANAGEMENT ---
        const bookmarkEditorList = document.getElementById('bookmark-editor-list');
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const bookmarkForm = document.getElementById('bookmark-form');
        const bookmarkFormTitle = document.getElementById('bookmark-form-title');
        const editIndexInput = document.getElementById('bookmark-edit-index');
        const imagePreview = document.getElementById('bookmark-image-preview');
        const imageUploadInput = document.getElementById('bookmark-image-upload');
        const hiddenImageSrcInput = document.getElementById('bookmark-image-hidden-src');

        function renderBookmarkEditor() {
            bookmarkEditorList.innerHTML = '';
            if(!userSettings.bookmarks) userSettings.bookmarks = [];
            userSettings.bookmarks.forEach((bookmark, index) => {
                const item = document.createElement('li');
                item.setAttribute('draggable', true);
                item.dataset.index = index;
                item.innerHTML = `<i class='bx bx-grid-vertical'></i><img src="${bookmark.imgSrc}" alt=""><div class="bookmark-info">${bookmark.alt}</div><div class="bookmark-actions"><button class="edit-bookmark-btn" title="Edit"><i class='bx bx-pencil'></i></button><button class="delete-bookmark-btn" title="Delete"><i class='bx bx-trash'></i></button></div>`;
                bookmarkEditorList.appendChild(item);
            });
            
            bookmarkEditorList.querySelectorAll('.delete-bookmark-btn').forEach((btn, index) => {
                btn.onclick = () => {
                    userSettings.bookmarks.splice(index, 1);
                    saveSettings(); applySettings(); renderBookmarkEditor();
                };
            });
            bookmarkEditorList.querySelectorAll('.edit-bookmark-btn').forEach((btn, index) => {
                btn.onclick = () => openBookmarkForm(index);
            });
        }
        
        function openBookmarkForm(index = null) {
            bookmarkForm.reset();
            if (index !== null) {
                // Editing existing bookmark
                const bookmark = userSettings.bookmarks[index];
                bookmarkFormTitle.textContent = 'Edit Bookmark';
                document.getElementById('bookmark-name').value = bookmark.alt;
                document.getElementById('bookmark-url').value = bookmark.href;
                hiddenImageSrcInput.value = bookmark.imgSrc;
                imagePreview.src = bookmark.imgSrc;
                imagePreview.style.display = 'block';
                imageUploadInput.required = false; // Not required when editing
                editIndexInput.value = index;
            } else {
                // Adding new bookmark
                bookmarkFormTitle.textContent = 'Add New Bookmark';
                imagePreview.style.display = 'none';
                imageUploadInput.required = true; // Required for new bookmarks
                editIndexInput.value = '';
            }
            bookmarkFormModal.style.display = 'block';
        }

        addBookmarkBtn.addEventListener('click', () => openBookmarkForm());

        bookmarkForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('bookmark-name').value;
            const url = document.getElementById('bookmark-url').value;
            const file = imageUploadInput.files[0];
            const editIndex = editIndexInput.value;

            const processBookmark = (imgSrc) => {
                const bookmarkData = { alt: name, href: url, imgSrc: imgSrc };
                if (editIndex !== '') {
                    userSettings.bookmarks[parseInt(editIndex, 10)] = bookmarkData;
                } else {
                    if (!userSettings.bookmarks) userSettings.bookmarks = [];
                    userSettings.bookmarks.push(bookmarkData);
                }
                saveSettings();
                applySettings();
                renderBookmarkEditor();
                bookmarkFormModal.style.display = 'none';
            };

            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    processBookmark(event.target.result); // Use base64 data URL
                };
                reader.readAsDataURL(file);
            } else if (editIndex !== '') {
                // If editing and no new file, use the old image src
                const existingImgSrc = hiddenImageSrcInput.value;
                processBookmark(existingImgSrc);
            }
        });

        let draggedItem = null;
        bookmarkEditorList.addEventListener('dragstart', (e) => {
            draggedItem = e.target.closest('li');
            setTimeout(() => draggedItem.classList.add('dragging'), 0);
        });
        bookmarkEditorList.addEventListener('dragend', () => {
            if(draggedItem) draggedItem.classList.remove('dragging');
        });
        bookmarkEditorList.addEventListener('dragover', e => {
            e.preventDefault();
            const afterElement = [...bookmarkEditorList.querySelectorAll('li:not(.dragging)')].reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = e.clientY - box.top - box.height / 2;
                return (offset < 0 && offset > closest.offset) ? { offset: offset, element: child } : closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
            if (afterElement == null) {
                if(draggedItem) bookmarkEditorList.appendChild(draggedItem);
            } else {
                if(draggedItem) bookmarkEditorList.insertBefore(draggedItem, afterElement);
            }
        });
        bookmarkEditorList.addEventListener('drop', () => {
            const newOrder = [];
            bookmarkEditorList.querySelectorAll('li').forEach(item => {
                newOrder.push(userSettings.bookmarks[item.dataset.index]);
            });
            userSettings.bookmarks = newOrder;
            saveSettings();
            applySettings();
            renderBookmarkEditor();
        });

        // --- DATA IMPORT/EXPORT ---
        document.getElementById('export-settings-btn').addEventListener('click', () => {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(userSettings, null, 2));
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr);
            dl.setAttribute("download", "homepage-settings.json");
            dl.click();
        });
        const importInput = document.getElementById('import-settings-input');
        importInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.bookmarks && imported.background) {
                        userSettings = imported;
                        saveSettings(); applySettings(); populateSettingsForm();
                    } else { alert('Invalid settings file.'); }
                } catch (error) { alert('Error reading file.'); }
            };
            reader.readAsText(file);
        });
        document.querySelector('label[for="import-settings-input"]').addEventListener('click', () => importInput.click());

        // --- INITIALIZATION & EVENT LISTENERS ---
        const themeToggleButton = document.getElementById('themeToggle');
        themeToggleButton.addEventListener('click', () => setTheme(body.dataset.theme === 'light' ? 'dark' : 'light'));
        window.addEventListener('resize', drawGrid);
        
        selectedOption.addEventListener("click", () => dropdownOptions.style.display = 'block');
        document.addEventListener("click", (e) => { if (!dropdown.contains(e.target)) dropdownOptions.style.display = "none"; });
        dropdownOptions.querySelectorAll("li").forEach(option => {
            option.addEventListener("click", function () {
                selectedOption.querySelector("img").src = this.querySelector("img").src;
                hiddenInput.value = this.dataset.value;
                dropdownOptions.style.display = "none";
                updateTabsVisibility(this.dataset.value);
            });
        });
        searchButton.addEventListener("click", performSearch);
        searchInput.addEventListener("keypress", (e) => { if (e.key === "Enter") performSearch(); });
        navLinks.forEach(link => {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove("active"));
                this.classList.add("active");
                currentSearchType = this.dataset.type;
            });
        });

        // --- Load everything ---
        setTheme(localStorage.getItem('themePreference') || 'light');
        loadSettings();
        updateWeather();
        updateTime();
        setInterval(updateTime, 1000);
        searchInput.focus();
        updateTabsVisibility("google");
    });
    </script>
</body>
</html>
